var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define(["ConfirmController"],function(e){var t;return t=function(){function t(){this.remove=__bind(this.remove,this),this.spareCookie=__bind(this.spareCookie,this),this.deleteCookie=__bind(this.deleteCookie,this),this.decrement=__bind(this.decrement,this),this.increment=__bind(this.increment,this),this.recount=__bind(this.recount,this),this.order=__bind(this.order,this),this.widget=$(".main>.basket"),0!==this.widget.length&&(this.itype="click",$("html").hasClass("touch")&&(this.itype="touchstart"),this.price=this.widget.find("header .price b, footer .price b"),this.delivery_free=this.widget.find(".delivery.free"),this.delivery_fee=this.widget.find(".delivery.fee"),this.submit=this.widget.find(".order"),this.card=$("body>header>nav>.card>b"),$(document).on(this.itype,".inc",this.increment),$(document).on(this.itype,".dec",this.decrement),$(document).on(this.itype,".remove",this.remove),this.submit.on(this.itype,this.order),this.recount())}return t.prototype.order=function(e){var t,i,r,n,s,o;for(e.preventDefault(),r={items:[]},o=this.widget.find(".item"),n=0,s=o.length;s>n;n++)t=o[n],t=$(t),i={id:t.attr("data-id"),count:parseInt(t.attr("data-count"),10)},r.items.push(i);return $.post("http://carrousel.com.ua/order/",r)},t.prototype.recount=function(){var e,t,i,r,n,s,o,a,d,c;for(a=0,r=this.widget.find(".item"),this.card.text(r.length>0?"("+r.length+")":"(хочу сладкого)"),d=0,c=r.length;c>d;d++)i=r[d],i=$(i),e=parseInt(i.attr("data-count"),10),t=i.find("menu span b"),t.text(e),n=parseFloat(i.attr("data-price"),10),s=i.find(".price b"),o=e*n,s.text(o!==Math.round(o)?o.toFixed(2):o),a+=o;return a>300?(this.delivery_free.removeClass("locked"),this.delivery_fee.addClass("locked")):(this.delivery_free.addClass("locked"),this.delivery_fee.removeClass("locked")),this.price.text(a!==Math.round(a)?a.toFixed(2):a)},t.prototype.increment=function(e){var t,i,r;return e.preventDefault(),t=$(e.currentTarget),r=t.closest(".item"),i=parseInt(r.attr("data-count"),10),r.attr("data-count",++i),this.recount()},t.prototype.decrement=function(t){var i,r,n;return t.preventDefault(),i=$(t.currentTarget),n=i.closest(".item"),r=parseInt(n.attr("data-count"),10),n.attr("data-count",Math.max(--r,0)),0===r&&new e({title:"Удалить вкусняшку? Точно-точно?",message:"Она очень расстроится…",agree:this.deleteCookie,agreeArgs:[n],agreeContext:this,decline:this.spareCookie,declineArgs:[n],declineContext:this,cancel:this.spareCookie,cancelArgs:[n],cancelContext:this}),this.recount()},t.prototype.deleteCookie=function(e){var t;return t=this.recount,e.fadeOut(function(){return $(this).remove(),t()})},t.prototype.spareCookie=function(e){return e.find(".inc").trigger("click")},t.prototype.remove=function(t){var i,r;return t.preventDefault(),i=$(t.currentTarget),r=i.closest(".item"),new e({title:"Удалить вкусняшку? Точно-точно?",message:"Она очень расстроится…",agree:this.deleteCookie,agreeArgs:[r],agreeContext:this,decline:this.spareCookie,declineArgs:[r],declineContext:this,cancel:this.spareCookie,cancelArgs:[r],cancelContext:this})},t}()});